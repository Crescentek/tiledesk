
# TLS


## Generate self signed TLS certificates
For this article, letâ€™s generate a self-signed certificate with openssl. For production use, you should request a trusted, signed certificate through a provider or your own certificate authority (CA). In the next step, you generate a Kubernetes Secret using the TLS certificate and private key generated by OpenSSL.


The following example generates a 2048-bit RSA X509 certificate valid for 365 days named *tiledesk-ingress-tls.crt*. The private key file is named *tiledesk-ingress-tls.key*. A Kubernetes TLS secret requires *both* of these files.

This article works with the *console.tiledesk.local* subject common name and doesn't need to be changed. For production use, specify your own organizational values for the -subj parameter:

```console
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -out tiledesk-ingress-tls.crt \
    -keyout tiledesk-ingress-tls.key \
    -subj "/CN=console.tiledesk.local/O=tiledesk-ingress-tls"
```

After creating the certificate please upload it using the following command:


```console
kubectl create secret tls tiledesk-tls-secret --key tiledesk-ingress-tls.key --cert tiledesk-ingress-tls.crt
```

## Generate GKE Managed TLS certificates

Create a ManagedCertificate resource. This resource specifies the domains that the SSL certificate will be created for. Wildcard domains are not supported.

Create a file named certificate-tiledesk.yaml like below:

```
apiVersion: networking.gke.io/v1beta1
kind: ManagedCertificate
metadata:
 name: certificate-tiledesk
spec:
 domains:
  - console.tiledesk.local
```
Create a new certificate for each domains you need. Attention create the DNS entry before applying the command. After that run:

```console
kubectl apply -f certificate-tiledesk.yaml
```

View your ssl certificates with:  ```kubectl describe managedcertificate certificate-tiledesk```. You can also use : ```gcloud beta compute ssl-certificates list --project GOOGLE_PROJECT_NAME```. If you want to delete an existing GKE certificate run: ```gcloud compute ssl-certificates delete CERTIFICATE_ID --project GOOGLE_PROJECT_NAME```

## Update the Ingress with TLS
Update the tls Ingress rule with :

```console
helm upgrade -f ./helm/values.yaml my-tiledesk ./helm --set ingress.tls[0].secretName=tiledesk-tls-secret --set ingress.tls[0].hosts[0]=console.tiledesk.local --set MQTT_ENDPOINT=wss://console.tiledesk.local/mqws/ws
```
With the MQTT_ENDPOINT env variable we are setting an absolute secure (wss) websocket URL.

Please see [this example](https://github.com/kubernetes/contrib/tree/master/ingress/controllers/nginx/examples/tls) for more information.



